---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostList from '../../components/PostList.astro';
import { getPublishedPosts } from '../../utils/content';

export async function getStaticPaths() {
  const posts = await getPublishedPosts();
  const tags = [...new Set(posts.flatMap((post) => post.data.tags))].sort((a, b) => a.localeCompare(b));
  return tags.map((tag) => ({
    params: { tag },
    props: {
      tag,
      posts: posts.filter((post) => post.data.tags.includes(tag))
    }
  }));
}

const { tag, posts } = Astro.props;
---

<BaseLayout title={`${tag} | Tag`}>
  <h1>Tag: {tag}</h1>
  <PostList posts={posts} />
</BaseLayout>
