---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getPublishedPosts } from '../../utils/content';
import { getAllTags, getPostPermalink, formatDate } from '../../utils/blog';

const posts = await getPublishedPosts();
const tags = getAllTags(posts);
---

<BaseLayout title="Tag Index | Musing on random technical subjects">
  <article class="card">
    <h1>Tag Index</h1>
    <div class="tag-list">
      {tags.map((tag) => (
        <a class="tag" href={`/tags/${encodeURIComponent(tag)}/`}>
          {tag} ({posts.filter((post) => post.data.tags.includes(tag)).length})
        </a>
      ))}
    </div>
  </article>

  {tags.map((tag) => (
    <section class="card" id={tag}>
      <h2>{tag}</h2>
      <ul>
        {posts
          .filter((post) => post.data.tags.includes(tag))
          .map((post) => (
            <li>
              <a href={getPostPermalink(post)}>{post.data.title}</a>
              {' - '}
              <time datetime={post.data.date.toISOString()}>{formatDate(post.data.date)}</time>
            </li>
          ))}
      </ul>
    </section>
  ))}
</BaseLayout>
